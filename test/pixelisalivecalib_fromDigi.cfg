process PIXELGAINCALIB = 
{
######################################################
#
#   By Freya Blekman
#
######################################################
# to change files change the following parameters:
# 1. the input file 
# 2. the calib database tag
# the following wiki page has lists of datasets: 
# https://twiki.cern.ch/twiki/bin/view/CMS/TIF_and_PSI_data
######################################################

######################################################
#  define the number of events to run on (-1 = all)
######################################################

   untracked PSet maxEvents = {untracked int32 input = -1}

############################################################
# define input file
############################################################
       
    source = PoolSource 
    { 
	# replace 'myfile.root' with the source file you want to use
	untracked vstring fileNames = {"file:pixeldigis.root"}
    }

#############################################
#   create calibdigis
#############################################

    include "CalibTracker/SiPixelGainCalibration/data/SiPixelCalibDigiProducer.cfi"

############################################################
# databases, cabling maps and geometry
############################################################
       

   include "CondTools/SiPixel/data/SiPixelCalibConfiguration.cfi"
   replace sipixelcalib_essource.toGet = { 
	{ 
	    string record = "SiPixelCalibConfigurationRcd"
	    # change the tag appropriately. 
	    # This tag string controls which calibration information is used and for now should match the used datafile.
	    string tag = "PixelAlive_PSI_347"
	},
	{ # this is cabling information, it contains the cabling map
	    string record = "SiPixelFedCablingMapRcd"
	    string tag = "SiPixelFedCablingMap_v9"
	}
    }

    include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
    include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
    include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

############################################################
# include DQM services
############################################################
 
#service = DaqMonitorROOTBackEnd{}
include "DQMServices/Core/data/DQM.cfg"
############################################################
# include the settings for sipixelgaincalibrationanalysis.cfi
############################################################
 
    include "CalibTracker/SiPixelIsAliveCalibration/data/SiPixelIsAliveCalibration.cfi"
    replace siPixelIsAliveCalibration.outputFileName="test_alive.root"
    replace siPixelIsAliveCalibration.DetSetVectorSiPixelCalibDigiTag=siPixelCalibDigis

############################################################
# include the message logger
############################################################
 
    include "FWCore/MessageService/data/MessageLogger.cfi"
    replace MessageLogger.cout =  {      
	untracked string threshold = "INFO"    
	#   untracked PSet default = { untracked int32 limit = 10000000 }  
	untracked PSet FwkReport =  { 
	    untracked int32 limit = 100000 
	    untracked int32 reportEvery = 2000 
	}
	untracked PSet Root_Information = { untracked int32 limit = 0 }
    }

############################################################
# uncomment these if you want to do timing studies...
############################################################

#    service = Timing {}

#module contentdump  = EventContentAnalyzer{}


############################################################
# define the various paths
############################################################
 
    path p = {siPixelCalibDigis,siPixelIsAliveCalibration} 

}
